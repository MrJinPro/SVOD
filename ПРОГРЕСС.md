# Прогресс разработки S.V.O.D

Дата: 10.01.2026

Документ фиксирует, что уже реализовано в репозитории, и что осталось сделать, чтобы соответствовать календарному плану (см. `календарный_план.csv`).

---

## Уже сделано (по факту в коде)

### Frontend
- Подключён готовый фронтенд (Vite + React + TS) в папке `svod-command-center/`.
- Страницы подключены к API (через `fetch`) с единым базовым URL и возможностью подставить токен:
  - Реализованы запросы для Dashboard/Events/Reports/Notifications/Users/Search.
  - Конфиг: `svod-command-center/.env.example`.

### Backend
- Создан каркас FastAPI: `backend/app/main.py`.
- Добавлена версия API v1 и роутер: `backend/app/api/v1/api.py`.
- Реализованы эндпоинты по модульной структуре (как в ТЗ):
  - Auth: `backend/app/api/v1/auth.py` (`POST /api/v1/auth/login`)
  - Events: `backend/app/api/v1/events.py` (`GET /api/v1/events`, `GET /api/v1/events/{id}`)
  - Reports: `backend/app/api/v1/reports.py` (`GET /api/v1/reports` + экспорт CSV)
  - Search: `backend/app/api/v1/search.py` (`GET /api/v1/search/events`)
- Добавлены зависимости для авторизации: `backend/app/api/v1/deps.py`.
- Реализован простой JWT (HS256) без внешних либ: `backend/app/core/security.py`.

### Модели данных (каркас)
- Добавлены SQLAlchemy модели (как база под следующий этап):
  - `backend/app/models/event.py`
  - `backend/app/models/report.py`
  - `backend/app/models/user.py`
  - базовый класс: `backend/app/db/base.py`
- Добавлены Pydantic схемы (DTO): `backend/app/schemas/*`.

### Фоновые задачи (Celery)
- Добавлен каркас Celery + Redis:
  - `backend/app/tasks/celery_app.py`
  - `backend/app/tasks/sync_tasks.py` (пока заглушка)
  - `backend/app/tasks/report_tasks.py`
- Добавлены зависимости: `celery`, `redis` в `backend/requirements.txt`.

### Экспорт отчётов
- Сделан минимальный экспорт суточного отчёта в CSV:
  - сервис: `backend/app/services/report_service.py`
  - эндпоинт: `GET /api/v1/reports/export/daily?date=YYYY-MM-DD`

### Развёртывание (Docker Compose)
- Добавлен тестовый контур развёртывания:
  - `docker-compose.yml` (postgres + redis + backend + celery_worker + frontend)
  - `backend/Dockerfile`
  - `svod-command-center/Dockerfile` + `svod-command-center/nginx.conf`
- Обновлены инструкции запуска в `README.md`.

---

## Что соответствует пунктам календарного плана

Этап 1 (MVP):
- Backend: Модели данных — **каркас добавлен** (модели + base).
- Backend: Основные API эндпоинты — **добавлены** (events/reports/search + auth).
- Frontend: Базовые компоненты — **есть** (готовый фронт).
- Frontend: Страница событий — **есть**.
- Frontend: Поиск и фильтры — **есть** (UI/страница; запросы через API).
- Система авторизации — **есть (MVP-уровень)**.
- Фоновые задачи (Celery) — **каркас есть**.
- Развёртывание на тестовом сервере — **docker-compose есть**.

---

## Осталось сделать (чтобы полноценно закрыть MVP по плану)

### Backend: работа с БД (PostgreSQL)
- Подключить реальные модели/миграции (Alembic), создать таблицы (events/clients/objects/users/reports и т.д.).
- Перевести эндпоинты `events/reports/search` с прототипных данных на PostgreSQL.

### Backend: поиск и фильтрация (PostgreSQL FTS)
- Реализовать полнотекстовый поиск по `description/object/client/location`.
- Добавить индексы и оптимизацию запросов.

### Интеграция с БД агентства (vwarchives)
- Реализовать чтение новых событий из источника (ODBC/MySQL/что будет фактически).
- Сделать запись в локальную БД + лог синхронизации.
- Включить по расписанию (Celery beat или cron).

### Базовая генерация отчётов (Excel/PDF)
- Сейчас сделан CSV (минимум).
- Нужно добавить экспорт в Excel/PDF (или хотя бы Excel) согласно плану.

### Тестирование MVP
- Добавить минимальные тесты на ключевые API (auth/events/reports).
- Добавить smoke-test для docker-compose (healthcheck).

### Демонстрация заказчику
- Подготовить сценарий демо (что показать, порядок, контрольные данные).
- Зафиксировать стабильный сборочный артефакт (docker compose up + инструкция).

---

## Блокеры / риски (текущие)

- На диске C: **0 GB свободно** → ломается установка Python-пакетов и создание venv.
  - Временно работаем на системном Python.
  - Для нормального dev-цикла нужно освободить место на C: или перенести кэши/venv на D:.

---

## Команды для запуска (быстро)

### Docker
```powershell
cd d:\alarm\SVOD_SOFT
docker compose up --build
```

### Без Docker
Backend:
```powershell
cd d:\alarm\SVOD_SOFT\backend
uvicorn app.main:app --reload --port 8000
```
Frontend:
```powershell
cd d:\alarm\SVOD_SOFT\svod-command-center
npm run dev
```

Авторизация (получить токен):
- `POST http://localhost:8000/api/v1/auth/login`
- Body: `{ "username": "ivanov_a", "password": "password" }`

